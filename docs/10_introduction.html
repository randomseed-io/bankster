<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Introduction</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="css/randomseed.css" /></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Bankster</span> <span class="project-version">2.2.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="10_introduction.html"><div class="inner"><span>Introduction</span></div></a></li><li class="depth-1 "><a href="11_sneak-peeks.html"><div class="inner"><span>Sneak peeks</span></div></a></li><li class="depth-1 "><a href="12_api.html"><div class="inner"><span>Bankster Front API</span></div></a></li><li class="depth-1 "><a href="15_contracts.html"><div class="inner"><span>Bankster Contracts</span></div></a></li><li class="depth-1 "><a href="20_data_structures.html"><div class="inner"><span>Data Structures</span></div></a></li><li class="depth-1 "><a href="30_currency-kinds.html"><div class="inner"><span>Currency kinds</span></div></a></li><li class="depth-1 "><a href="32_currency_traits.html"><div class="inner"><span>Currency traits</span></div></a></li><li class="depth-1 "><a href="50_example_config.html"><div class="inner"><span>Example EDN config</span></div></a></li><li class="depth-1 "><a href="50_serialization.html"><div class="inner"><span>Serialization</span></div></a></li><li class="depth-1 "><a href="80_Apache-2-License.html"><div class="inner"><span>Apache License, v2.0</span></div></a></li><li class="depth-1 "><a href="85_LGPL-3-License.html"><div class="inner"><span>LGPL License, v3 or later</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>randomseed</span></div></div></li><li class="depth-3"><a href="io.randomseed.bankster.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bankster</span></div></a></li><li class="depth-4"><a href="io.randomseed.bankster.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.api.currency.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>currency</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.api.money.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>money</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.api.ops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ops</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.api.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-5"><a href="io.randomseed.bankster.api.v2.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v2</span></div></a></li><li class="depth-6 branch"><a href="io.randomseed.bankster.api.v2.currency.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>currency</span></div></a></li><li class="depth-6 branch"><a href="io.randomseed.bankster.api.v2.money.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>money</span></div></a></li><li class="depth-6 branch"><a href="io.randomseed.bankster.api.v2.ops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ops</span></div></a></li><li class="depth-6"><a href="io.randomseed.bankster.api.v2.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.config.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.currency.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>currency</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.init.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>init</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.jsr-354.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jsr-354</span></div></a></li><li class="depth-4"><a href="io.randomseed.bankster.money.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>money</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.money.inter-ops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>inter-ops</span></div></a></li><li class="depth-5"><a href="io.randomseed.bankster.money.ops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ops</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.registry.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-4 branch"><a href="io.randomseed.bankster.scale.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scale</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serializers</span></div></div></li><li class="depth-5 branch"><a href="io.randomseed.bankster.serializers.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.serializers.edn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-5"><a href="io.randomseed.bankster.serializers.json.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>json</span></div></a></li><li class="depth-4"><a href="io.randomseed.bankster.util.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.util.fs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs</span></div></a></li><li class="depth-5 branch"><a href="io.randomseed.bankster.util.importer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>importer</span></div></a></li><li class="depth-5"><a href="io.randomseed.bankster.util.map.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>map</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introduction" id="introduction"></a>Introduction</h1>
<p><strong>Money as data, done right.</strong></p>
<p><em>A pragmatic, EDN-friendly money &amp; currency toolkit for Clojure: ISO 4217 / crypto / custom currencies, with precision-first arithmetic and an expressive DSL layer.</em></p>
<p><a href="https://clojars.org/io.randomseed/bankster"><img src="https://img.shields.io/clojars/v/io.randomseed/bankster.svg" alt="Bankster on Clojars" /></a> <a href="https://cljdoc.org/d/io.randomseed/bankster/CURRENT"><img src="https://cljdoc.org/badge/io.randomseed/bankster" alt="Bankster on cljdoc" /></a> <a href="https://circleci.com/gh/randomseed-io/bankster"><img src="https://circleci.com/gh/randomseed-io/bankster.svg?style=svg" alt="CircleCI" /></a></p>
<p>This is a Clojure library for operating on monetary units with cryptocurrency and custom currency support.</p>
<h2><a href="#who-is-this-for" id="who-is-this-for"></a>Who is this for?</h2>
<p>Bankster shines when you need <em>money as data</em> — predictable, comparable, composable — without sacrificing ergonomics.</p>
<p>Typical users and use-cases:</p>
<ul>
<li><strong>Fintech / payments / wallets / exchanges</strong>: model fiat + crypto under one coherent API (including non-standard codes).</li>
<li><strong>Accounting-ish domains</strong>: operate on amounts with fixed, explicit scale and controlled rounding.</li>
<li><strong>Data pipelines &amp; ETL</strong>: parse/emit EDN safely (tagged literals, data readers) and keep currency semantics attached to numbers.</li>
<li><strong>Systems integrating many “currency worlds”</strong>: keep separate registries per source/environment (dynamic/global/local registries).</li>
<li><strong>Apps that want a small “money DSL”</strong>: concise literals/macros for currencies and amounts.</li>
</ul>
<p>If your primary need is exchange-rate discovery, market data, or full-blown accounting/ledger rules — Bankster is intentionally smaller and focuses on representing currency + amount and doing safe operations around that.</p>
<h2><a href="#why-bankster-in-one-breath" id="why-bankster-in-one-breath"></a>Why Bankster (in one breath)</h2>
<ul>
<li><strong>Precision-first arithmetic</strong>: <code>BigDecimal</code> everywhere, currency scale-aware operations, and tooling for non-terminating expansions.</li>
<li><strong>Allocation and distribution</strong>: built-in functions for allocating and distributing monetary amounts.</li>
<li><strong>One model for ISO + crypto + custom</strong>: namespaced identifiers like <code>crypto/ETH</code>, plus conflict-safe code resolution via weights.</li>
<li><strong>EDN-native ergonomics</strong>: tagged literals (<code>#money</code>, <code>#currency</code>), readers, macros, and parsing that make data pipelines pleasant.</li>
<li><strong>Registry concept</strong>: treat currencies as a database you can extend, swap, or scope per computation.</li>
<li><strong>Polymorphism</strong>: protocols (<code>Scalable</code>, <code>Monetary</code>, <code>Accountable</code>) keep it extensible and composition-friendly.</li>
</ul>
<h2><a href="#features" id="features"></a>Features</h2>
<ul>
<li>Pure Clojure implementation based on Java’s <strong>BigDecimal</strong>.</li>
<li>Uses <strong>records</strong> to organize data: <code>Registry</code>, <code>Currency</code>, <code>Money</code>.</li>
<li>Built-in standard <strong>currencies database</strong>, extendable with EDN file.</li>
<li>Ability to create <em>ad hoc</em> currencies (with optional registering).</li>
<li>Different sources of <strong>currency registries</strong> (dynamic, global or local).</li>
<li>Registry <strong>hierarchies</strong> for classification (<code>:domain</code>, <code>:kind</code>, custom)<br />
and optional per-currency <strong>traits</strong>.</li>
<li><strong>Polymorphic</strong> interfaces (<code>Scalable</code>, <code>Monetary</code>, <code>Accountable</code> protocols).</li>
<li>Ability to <strong>cast</strong> and <strong>convert</strong> monetary amounts.</li>
<li>Useful <strong>macros</strong> to express currencies and monetary amounts with various forms.</li>
<li><strong>Namespaced identifiers</strong> for non-ISO currencies (e.g. <code>crypto/ETH</code>).</li>
<li>Common <strong>math operators</strong>.</li>
<li><strong>Auto-rescaling</strong> in math operations to handle non-terminating decimal expansion.</li>
<li>Variants of <strong>variadic math functions</strong> with rescaling after each consecutive operation.</li>
<li>Optional <strong>rescaling</strong> of monetary amounts with keeping track of nominal scales.</li>
<li>Functions for <strong>rounding</strong> to a scale or to the given <strong>interval</strong>.</li>
<li>Functions for <strong>allocating</strong> and <strong>distributing</strong> of monetary amounts.</li>
<li><strong>Tagged literals</strong> for currencies and monetary amounts.</li>
<li><strong>Data readers</strong> for currencies and monetary amounts expressed with EDN.</li>
<li>Customizable currency and money <strong>formatting</strong> with <strong>locale support</strong>.</li>
<li><strong>JSON and EDN serialization</strong> with per-format protocols, minimal/full representations, and Cheshire integration.</li>
</ul>
<h2><a href="#contracts" id="contracts"></a>Contracts</h2>
<p>See <a href="15_contracts.html">Bankster Contracts</a> for practical contracts (what is guaranteed, what is “soft” vs “strict”, how the default registry is chosen, when exceptions are thrown, how the protocols behave) for Bankster’s core axis: <code>Currency</code>, <code>Money</code>, <code>Registry</code> records and the <code>Monetary</code>, <code>Scalable</code> and <code>Accountable</code> protocols.</p>
<h2><a href="#front-api" id="front-api"></a>Front API</h2>
<p>Bankster provides a curated front API under <code>io.randomseed.bankster.api.*</code> (recommended for application code). See <a href="12_api.html">API</a> for an overview.</p>
<p>For major-version stability there is a frozen API namespace: <code>io.randomseed.bankster.api.v2</code> and its sub-namespaces. It mirrors <code>io.randomseed.bankster.api</code> for the Bankster 2.x line. When Bankster 3 appears, the v2 API will remain available for compatibility. In the current release, <code>io.randomseed.bankster.api.v2.*</code> is equivalent to <code>io.randomseed.bankster.api.*</code>.</p>
<h2><a href="#installation" id="installation"></a>Installation</h2>
<p>To use Bankster in your project, add the following to dependencies section of <code>project.clj</code> or <code>build.boot</code>:</p>
<pre><code class="language-clojure">[io.randomseed/bankster "2.2.2"]
</code></pre>
<p>For <code>deps.edn</code> add the following as an element of a map under <code>:deps</code> or <code>:extra-deps</code> key:</p>
<pre><code class="language-clojure">io.randomseed/bankster {:mvn/version "2.2.2"}
</code></pre>
<p>You can also download JAR from <a href="https://clojars.org/io.randomseed/bankster">Clojars</a>.</p>
<h2><a href="#design" id="design"></a>Design</h2>
<p>The core design principle: <strong>money is a value with a currency attached</strong>, and currencies live in a <strong>registry</strong> that can be global, dynamic, or explicitly passed around. This keeps both <em>precision</em> and <em>context</em> explicit.</p>
<h3><a href="#registry-of-currencies" id="registry-of-currencies"></a>Registry of currencies</h3>
<p>There is a global, shared <strong>registry</strong> (<code>Registry</code>) of currencies, which is thread-safe and encapsulated in an Atom. It consists of databases (maps) for quickly accessing important currency properties. Most of the functions will use this global registry, unless a registry is explicitly passed as an argument or set as a dynamic variable.</p>
<p>Registry is implemented as a record of maps keeping the following associations:</p>
<ul>
<li>currency ID to currency object;</li>
<li>currency ID to a set of country IDs;</li>
<li>currency numeric ID to currency object;</li>
<li>country ID to currency object;</li>
<li>currency ID to localized properties map;</li>
<li>currency ID to traits set (advisory tags/features);</li>
<li>currency ID to weight (an integer used for conflict resolution);</li>
<li>currency code to a sorted set of currency objects (weighted);</li>
<li>currency numeric ID to a sorted set of currency objects (weighted);</li>
<li>currency domain to a sorted set of currency objects (weighted).</li>
</ul>
<p>Registry also carries:</p>
<ul>
<li><code>:hierarchies</code> – classification hierarchies (e.g. <code>:domain</code>, <code>:kind</code>, <code>:traits</code>, and any custom axes);</li>
<li><code>:ext</code> – a free-form extension map for registry-level metadata.</li>
</ul>
<p>In most cases you won’t have to worry about the internals of a registry. However, when working with multiple data sources or data processing engines (like currency exchange platforms), you may find it useful to have <strong>different registries</strong> (with the same currencies but of different scales). Most of the functions operating on monetary units and currencies will accept a registry object as their additional argument. The exceptions are math operations (especially variadic) for which the only way to use different registry is to set a dynamic variable <code>io.randomseed.bankster.registry/*default*</code> (which can be done using the macro <code>io.randomseed.bankster.api.registry/with</code>).</p>
<p><code>registry/new-registry</code> expects <em>base maps</em> (e.g. <code>:cur-id-&gt;cur</code>, <code>:ctr-id-&gt;cur</code>, <code>:cur-id-&gt;localized</code>, <code>:cur-id-&gt;traits</code>, <code>:cur-id-&gt;weight</code>) and builds all derived index maps during initialization (<code>:cur-code-&gt;curs</code>, <code>:cur-nr-&gt;cur</code>, <code>:cur-nr-&gt;curs</code>, <code>:cur-dom-&gt;curs</code>, <code>:cur-id-&gt;ctr-ids</code>). Even the arity that accepts a Registry map/record ignores any derived index fields (they are recomputed during initialization).</p>
<p>When the library loads, its predefined configuration is read from a default EDN file and its contents populate the default, global registry. This registry can be modified too.</p>
<h4><a href="#custom-registry-initialization-disable-auto-init" id="custom-registry-initialization-disable-auto-init"></a>Custom registry initialization (disable auto-init)</h4>
<pre><code class="language-clojure">;; Disable Bankster's default registry auto-initialization (config.edn)
;; at namespace load time. You typically want this when you plan
;; to fully control which registry is used.

(binding [io.randomseed.bankster/*initialize-registry* false]
  (require '[io.randomseed.bankster.api.currency :as currency]
           '[io.randomseed.bankster.api.registry :as registry]))

;; Load your registry from a classpath resource
;; (e.g. resources/my/app/currencies.edn).

(def my-registry
  (currency/config-&gt;registry "my/app/currencies.edn"))

;; Option A: pass the registry explicitly (front API).

(currency/resolve     :EUR my-registry)
(currency/resolve-try :EUR my-registry)  ; nil when missing

;; Option B: install it as the global registry.

(registry/set! my-registry)
</code></pre>
<h4><a href="#registry-loader-helpers-iorandomseedbanksterinit" id="registry-loader-helpers-iorandomseedbanksterinit"></a>Registry loader helpers (<code>io.randomseed.bankster.init</code>)</h4>
<p>If you want to load a registry in a single call (optionally overlaying Bankster’s distribution config), use <code>io.randomseed.bankster.init</code>:</p>
<pre><code class="language-clojure">(require '[io.randomseed.bankster.init :as init])

;; Load ONLY the provided config (no dist overlay).

(def r1 (init/load-registry "my/app/currencies.edn"))

;; Load dist config first, then overlay user config
;; using importer/merge-registry.

(def r2 (init/load-registry "my/app/currencies.edn"
                            {:keep-dist? true
                             :merge-opts {:verbose? true
                                          :preserve-fields [:domain :kind]
                                          :iso-like? false}}))

;; Side-effecting variant: installs the result as the global registry.

(init/load-registry! "my/app/currencies.edn" {:keep-dist? true})
</code></pre>
<p>Configuration (<code>config.edn</code>) is branch-oriented by default (<code>:currencies</code>, plus top-level branches like <code>:countries</code>, <code>:localized</code>, <code>:traits</code>, and <code>:weights</code>). <code>:countries</code> is keyed by country ID (country -&gt; currency), whereas <code>:localized</code>, <code>:traits</code>, and <code>:weights</code> are keyed by currency ID. For convenience, each currency entry may also carry inline <code>:countries</code> (seq of country IDs), <code>:localized</code> and <code>:traits</code> which are merged into the global branches while loading (they do not become currency fields; per-currency values take precedence). Similarly, a currency entry may include inline <code>:weight</code> (or <code>:we</code>) which is normalized into the top-level <code>:weights</code> branch.</p>
<p>If you need selected extra keys from currency maps to be preserved on the constructed <code>Currency</code> objects (extension fields), use <code>:propagate-keys</code> in the config (global allowlist) or per-currency <code>:propagate-keys</code> (override).</p>
<h3><a href="#hierarchies-and-traits" id="hierarchies-and-traits"></a>Hierarchies and traits</h3>
<p>Bankster can store classification hierarchies in a registry and use them for semantic queries via <code>clojure.core/isa?</code>.</p>
<p>Registry key <code>:hierarchies</code> is a <code>CurrencyHierarchies</code> record that may contain:</p>
<ul>
<li><code>:domain</code> – hierarchy of domains (e.g. <code>:ISO-4217-LEGACY</code> is a kind of <code>:ISO-4217</code>);</li>
<li><code>:kind</code> – hierarchy of currency kinds (your taxonomy, including namespaced kinds);</li>
<li><code>:traits</code> – optional hierarchy of traits (advisory; useful for tags like token standards).</li>
</ul>
<p>Hierarchy specs are expressed as a parent-map <code>{child parent}</code> and may also use a vector/set of parents for multiple inheritance.</p>
<p>Traits are stored separately as a registry map <code>currency-id -&gt; traits</code> (sets/vectors of keywords). They are intentionally <em>not</em> part of currency identity and do not affect money equality or arithmetic.</p>
<pre><code class="language-clojure">(require '[io.randomseed.bankster.api.registry :as registry]
         '[io.randomseed.bankster.api.currency :as currency])

(def r
  (assoc (registry/new
          {:hierarchies {:domain {:ISO-4217-LEGACY :ISO-4217
                                  :CRYPTO          :VIRTUAL}
                         :traits {:token/erc20 :token/fungible
                                  :token/bep20 :token/fungible
                                  :stable/coin [:stable :token/fungible]}}})
         :cur-id-&gt;traits {:crypto/USDC #{:token/erc20 :stable/coin}}))

;; Domains can be queried using a hierarchy-aware predicate.

(currency/of-domain? :ISO-4217 (currency/new :iso-4217-legacy/ADP) r)
;; =&gt; true

;; Traits can be queried via the traits hierarchy.

(currency/of-trait? :token/fungible :crypto/USDC r)
;; =&gt; true
</code></pre>
<p>To extend a hierarchy programmatically use <code>api-registry/hierarchy-derive</code> (pure) or <code>api-registry/hierarchy-derive!</code> (mutates the global registry).</p>
<h3><a href="#currency" id="currency"></a>Currency</h3>
<p>Each <strong>currency</strong> (<code>Currency</code>) is a record having the following fields, reflecting its properties:</p>
<ul>
<li><code>id</code> – a keyword <strong>identifying</strong> a currency unit (e.g. <code>:EUR</code> or <code>:crypto/ETH</code>);</li>
<li><code>numeric</code> – a long value being a <strong>numeric identifier</strong> of ISO-standardized currencies;</li>
<li><code>scale</code> – an integer of supported <strong>scale</strong> (decimal places);</li>
<li><code>kind</code> – a keyword with currency <strong>kind</strong>;</li>
<li><code>domain</code> – a keyword with currency <strong>domain</strong>.</li>
</ul>
<p>Additionally, currency may carry a non-inherent attribute <code>:weight</code> (an integer), used only to resolve conflicts when multiple currencies share the same currency code or numeric ID (lower weight wins).</p>
<p>The source of truth for weights is the registry base map <code>:cur-id-&gt;weight</code> (exported to EDN under top-level <code>:weights</code>). Currency instances stored in registries carry the weight in metadata as an optimization (hot-path: weighted buckets), but weight does not affect <code>=</code> / <code>hash</code> semantics. Use <code>api-currency/weight</code> to read it.</p>
<p>To mutate weights and traits (which are registry attributes) use: <code>api-currency/set-weight</code>/<code>api-currency/clear-weight</code> and <code>api-currency/set-traits</code>/<code>api-currency/add-traits</code>/<code>api-currency/remove-traits</code> (plus <code>!</code> variants operating on the global registry).</p>
<p><strong>Currency ID</strong> is a unique identifier of a currency within a registry. Internally it is a keyword and optionally it can have a namespace. By default Bankster identifies standard currencies with IDs reflecting their official currency codes and cryptocurrencies with identifiers having <code>crypto</code> namespace.</p>
<p><strong>Currency code</strong> is a name of currency ID without its namespace. It is potentially conflicting attribute, therefore the mapping of currency codes to sets of currency objects exists in a registry. It allows to get currencies using their codes (and not add namespace, especially when interacting with some external API) and still maintain uniqueness of identifiers. If custom currency is created with the same code as already existing currency, it is possible to give it a <strong>weight</strong> (lower weight wins) which will decide whether its code will have priority during resolution (and getting from a registry).  Currency <code>:weight</code> is a registry resolution mechanism and is treated as non-semantic in equality and arithmetic on monetary values.</p>
<p><strong>Currency domain</strong> is a keyword which groups currencies into separate “worlds”. By default it is derived from the namespace of currency ID (upper-cased), e.g. <code>:crypto/ETH</code> implies <code>:domain :CRYPTO</code>. Namespace <code>ISO-4217</code> is treated specially: it is stripped (case-insensitive) and implies <code>:domain :ISO-4217</code>. Additionally, ISO-like currencies may get <code>:ISO-4217</code> inferred from their code + numeric ID.</p>
<p>Domains can be organized in a registry hierarchy (<code>api-registry/hierarchy :domain</code>) and queried with <code>api-currency/of-domain?</code>. To list or select currencies by domain, use <code>api-currency/domains</code> and <code>api-currency/of-domain</code>.</p>
<p><strong>Currency kind</strong> is a case-sensitive keyword that should describe what the currency is. It can be set to anything, even nil. Some common values are:</p>
<ul>
<li><code>:iso</code>       - ISO-4217 currencies, funds, commodities, special markers.</li>
<li><code>:virtual</code>   - Virtual units (stable tokens, credits, native tokens, special).</li>
<li><code>:currency</code>  - Meta: currency-like units; parent for <code>:fiduciary</code> money.</li>
<li><code>:asset</code>     - Meta: value-bearing units (<code>:assets</code>, <code>:claims</code>, <code>:stable</code>, reference-based).</li>
<li><code>:fiat</code>      - Meta umbrella: fiat-related tags (issuer fiats vs fiat-as-anchor).</li>
<li><code>:funds</code>     - Meta: funds, settlement units, units of account.</li>
<li><code>:commodity</code> - Meta: commodity-based units and commodity anchoring.</li>
<li><code>:special</code>   - Meta: special-purpose markers (<code>:experimental</code>, <code>:test</code>, <code>:null</code>).</li>
</ul>
<p>In new code it is recommended to use namespaced kinds (for example: <code>:iso/fiat</code>, <code>:iso/funds</code>, <code>:virtual/native</code>, <code>:virtual/token</code>, <code>:virtual.stable.peg/fiat</code>).</p>
<p>Kinds can be organized in a registry hierarchy (<code>api-registry/hierarchy :kind</code>) and queried with <code>api-currency/of-kind?</code>.</p>
<p>Currencies can can be tested against their ancestors in a hierarchy of kinds using API functions, so doing <code>(api-currency/of-kind :fiat :PLN)</code> will return <code>true</code> since this currency has its kind set to <code>:iso/fiat</code>.</p>
<p>The default kind taxonomy and its relationships (as shipped in the default <code>config.edn</code>) are documented in <a href="30_currency-kinds.html">Currency Kinds</a>. The default traits taxonomy is documented in <a href="32_currency_traits.html">Currency Traits</a>.</p>
<p><strong>Currency scale</strong> is the nominal scale of a currency. If it is not set, the automatic scale will be used on monetary amounts using such a currency.</p>
<p>Registry-related functions are accepting currency representations based on their <strong>identifiers</strong>. Other functions and macros will usually accept <strong>currency codes</strong>. In case of conflict the currency with lower <strong>currency weight</strong> will be picked up.</p>
<p>Currencies can also have <strong>additional</strong>, external properties, like relations to countries, localized (l10n) settings etc. They are stored in registries too.</p>
<p>To inspect a currency including registry-associated metadata (countries, localized properties, traits) use <code>api-currency/info</code>.</p>
<h3><a href="#money" id="money"></a>Money</h3>
<p>Having a currency defined we can create <strong>money</strong> objects (<code>Money</code>) which are based on records having 2 fields:</p>
<ul>
<li><code>currency</code> – a <code>Currency</code> object;</li>
<li><code>amount</code> – a <code>BigDecimal</code> value.</li>
</ul>
<p>The initial scale (number of decimal places) of an amount will be set to nominal scale of the currency. Math operations will then respect this scale during calculations and preserve it. In rare cases it is possible to rescale the amount, check whether the monetary object is rescaled and scale it back to a scale of the currency.</p>
<h4><a href="#rounding-mode-performance-note" id="rounding-mode-performance-note"></a>Rounding mode (performance note)</h4>
<p>Rounding in Bankster is controlled by dynamic vars from <code>io.randomseed.bankster.scale</code>: <code>scale/*rounding-mode*</code> (and for some multi-arg operations also <code>scale/*each*</code>).</p>
<p>Prefer using Bankster macros:</p>
<ul>
<li><code>api-money/with-rounding</code> (alias for <code>scale/with-rounding</code>) to set the rounding mode;</li>
<li><code>api-money/with-rescaling</code> / <code>scale/with-rescaling</code> to also rescale after each step.</li>
</ul>
<p>These macros keep semantics consistent with a plain <code>binding</code>, but they also set an internal thread-local fast path for rounding-mode lookups. Direct <code>binding</code> of <code>scale/*rounding-mode*</code> is supported, but does not use this fast path and may be noticeably slower in tight numeric loops.</p>
<h3><a href="#importing-and-merging-registries" id="importing-and-merging-registries"></a>Importing and merging registries</h3>
<p>Namespace <code>io.randomseed.bankster.util.importer</code> provides practical tooling for building and merging currency registries from external sources (most notably: Joda Money CSV files).</p>
<p>Highlights:</p>
<ul>
<li>
<p>CSV loader supports comment lines and inline <code># ...</code> comments (preserved for post-processing).</p>
</li>
<li>
<p>Joda currency comments are used to infer ISO legacy IDs (“Old, now …”) and ISO funds kinds (“FundsCode …”).</p>
</li>
<li>
<p>When ISO legacy is inferred, Bankster also tags the currency with trait <code>:legacy</code>.</p>
</li>
<li>
<p>When merging <code>seed.edn</code> with Joda CSV imports, a practical default is to treat <code>seed.edn</code> as the semantic authority (domain/kind/traits/weights/localized), while refreshing <code>:numeric</code> and <code>:scale</code> from the CSV. This is expressed via <code>importer/merge-registry</code> + <code>preserve-fields</code> (and optionally <code>::importer/countries</code> if you want to preserve assigned countries from the seed).</p>
</li>
<li>
<p><code>importer/merge-registry</code> merges registries together with <code>:hierarchies</code> and <code>:ext</code>, supports preserving selected currency fields (and/or localized properties and assigned countries), and can align ISO vs legacy classification in “ISO-like” mode.</p>
</li>
<li>
<p>Export helpers:</p>
</li>
<li><code>importer/export</code> writes a branch-oriented config (as produced by <code>registry-&gt;map</code>),</li>
<li><code>importer/export-currency-oriented</code> writes a currency-oriented config (per-currency <code>:countries/:localized/:traits</code> embedded into <code>:currencies</code>, top-level branches keep only orphaned entries),</li>
<li><code>importer/map-&gt;currency-oriented</code> is the post-process transformer (map -&gt; map).</li>
</ul>
<pre><code class="language-clojure">(require '[io.randomseed.bankster.util.importer :as importer])

;; Generate a Bankster EDN export from Joda Money CSV resources.
(importer/joda-&gt;bankster-export)

;; Merge two registries (verbose + preserve :domain/:kind and localized props, while
;; letting ISO-like source align ISO vs legacy classification).
;;
;; In this setup `seed.edn` stays authoritative for domain/kind and localized props,
;; while numeric/scale (and countries, unless preserved) are refreshed from CSV.
(let [dst (importer/seed-import)
      src (importer/joda-import)]
  (importer/merge-registry dst src true [:domain :kind ::importer/localized] true))

;; Export a registry in two equivalent shapes.
(importer/export dst)                    ; branch-oriented
(importer/export-currency-oriented dst)  ; currency-oriented
</code></pre>
<h3><a href="#experimental-jsr-354-semantic-bridge" id="experimental-jsr-354-semantic-bridge"></a>Experimental: JSR-354 semantic bridge</h3>
<p>Namespace <code>io.randomseed.bankster.jsr-354</code> is an experimental, work-in-progress Clojure semantic bridge inspired by JSR-354 (JavaMoney). It is not a Java implementation/interface of the standard. The goal is to progressively cover more of JSR-354 semantics in future Bankster releases; until then, treat this namespace as unstable.</p>
<h2><a href="#quickstart" id="quickstart"></a>Quickstart</h2>
<p>Bankster models currencies and monetary amounts. The recommended entrypoint is the Front API (<code>io.randomseed.bankster.api.*</code>) and the default registry.</p>
<pre><code class="language-clojure">;; deps.edn

{io.randomseed/bankster {:mvn/version "2.2.2"}}

;; Leiningen

[io.randomseed/bankster "2.2.2"]
</code></pre>
<pre><code class="language-clojure">(require
  '[io.randomseed.bankster.api          :as   b]
  '[io.randomseed.bankster.api.money    :as   m]
  '[io.randomseed.bankster.api.currency :as   c]
  '[io.randomseed.bankster.api.ops      :as ops])
</code></pre>
<pre><code class="language-clojure">(def usd (c/resolve "USD"))
(def pln (c/resolve "PLN"))
(def a   (m/resolve 12.34M usd))
(def b   (m/resolve 10M pln))
(ops/+ a (m/resolve 1.66M usd))
(c/resolve-try "NOT_A_CURRENCY") ; =&gt; nil
</code></pre>
<p><strong>Strict</strong> variants throw on missing currency/match; <strong>soft</strong> variants (usually <code>-try</code>) return <code>nil</code>. Use soft at boundaries (parsing/import), strict in core domain logic. Quickstart uses the default registry; registry scoping options are described in the docs.</p>
<ul>
<li>
<p>For demonstrative snippets see <a href="11_sneak-peeks.html">Sneak Peeks</a>.</p>
</li>
<li>
<p>For more complete, runnable examples see the <code>examples/</code> directory in the <a href="https://github.com/randomseed-io/bankster/tree/main/examples">source repository</a>.</p>
</li>
<li>
<p>To get the list of available Front API forms visit <a href="12_api.html">API</a>.</p>
</li>
<li>
<p>To know contracts governing the library see <a href="15_contracts.html">Bankster Contracts</a>.</p>
</li>
</ul>
<h2><a href="#pitfalls" id="pitfalls"></a>Pitfalls</h2>
<p>A few things that can bite you in production if you treat money/currency like “just numbers and strings”:</p>
<ul>
<li><strong>Don’t use <code>clojure.core/=</code> to compare Money.</strong></li>
</ul>
<p>BigDecimal equality is scale-sensitive (1.0 vs 1.00), so value-equality can surprise you. Use Bankster’s dedicated predicates (e.g. <code>money/eq?</code>, <code>money/==</code>) or the operator layer (<code>money.inter-ops</code>, <code>money.api.inter-ops</code>) depending on the semantics you want.</p>
<ul>
<li><strong>Be careful with untrusted input – avoid keyword interning.</strong></li>
</ul>
<p>Turning arbitrary user data into keywords can leak memory (interning is global). Prefer string IDs/codes and the helper functions intended for untrusted values (e.g. <code>to-id-str</code>, <code>to-code-str</code>), then resolve currencies through the registry.</p>
<ul>
<li><strong>Non-terminating division requires an explicit policy.</strong></li>
</ul>
<p>BigDecimal division can throw for non-terminating results unless you provide a rounding/rescaling policy. In Bankster, use the rounding/rescaling helpers (or the Front API variants that accept a rounding mode) so the behavior is deterministic and documented.</p>
<ul>
<li><strong>Know whether you want strict or soft behavior at the boundaries.</strong></li>
</ul>
<p>Bankster provides strict (throwing) and soft (nil-returning) variants (e.g. <code>resolve</code> vs <code>resolve-try</code>, <code>money</code> vs <code>money-try</code>). A good pattern is: soft at system boundaries (parsing/import), strict in the core business logic.</p>
<ul>
<li><strong>Registries are a feature – but choose the scoping deliberately.</strong></li>
</ul>
<p>Registry can be global, dynamically scoped, or passed explicitly. Pick one policy per subsystem to avoid “it works on my machine” issues (especially in tests and multi-tenant setups).</p>
<h3><a href="#warning-about-literal-amounts" id="warning-about-literal-amounts"></a>Warning about literal amounts</h3>
<p>Clojure changes number literals into objects of various numeric data types. Some of them will have fixed precision when there is a decimal separator present, yet they will not be big decimals before entering monetary functions of Bankster.</p>
<p>Putting a decimal number having more than 16–17 digits will often result in <strong>accidental approximation</strong> and casting it to a double value. This value may become the amount of money which probably is not what you want:</p>
<pre><code class="language-clojure">1234.5678910111213000001
; =&gt; 1234.5678910111212
</code></pre>
<p>To work around that you should:</p>
<ul>
<li>Use <strong>big decimal literals</strong> (e.g. <code>(api-money/of XXX 1234.56789101112M)</code> – note the <code>M</code>).</li>
<li>Use <strong>strings</strong> (e.g. <code>(api-money/of "1234.56789101112 XXX")</code>).</li>
<li>Use <code>api-money/of</code> macro or <code>#money</code> tagged literal with amount and currency in joint form (or with the above tactics applied), e.g.:</li>
<li><code>(api-money/of XXX123.45678)</code>,</li>
<li><code>#money XXX123.45678</code>,</li>
<li><code>#money "XXX123.45678"</code>,</li>
<li><code>#money "123.456789101112 XXX"</code>,</li>
<li><code>#money[123.45678M XXX]</code>.</li>
</ul>
<p>As it may not be a problem in case of regular currencies, it may pop-up when using scale-wide cryptocurrencies, like Ether or Ethereum tokens, having 18 decimal places.</p>
<h2><a href="#documentation" id="documentation"></a>Documentation</h2>
<p>Full documentation is available at:</p>
<ul>
<li><a href="https://randomseed.io/software/bankster/">https://randomseed.io/software/bankster/</a></li>
<li><a href="https://cljdoc.org/d/io.randomseed/bankster/">https://cljdoc.org/d/io.randomseed/bankster/</a></li>
</ul>
<h2><a href="#why" id="why"></a>Why?</h2>
<p>In one of my personal projects I needed support for both, ISO-standardized and custom currencies. My first try was Money (by Clojurewerkz), which is quite mature library based on Java’s Joda Money. However, I needed cryptocurrencies support, and I mean all of them, including those having non-standard codes (like <code>DASH</code>).</p>
<p>First I tried to modify Money and work-around this limitation by imitating such currencies with an additional map translating custom codes into standardized ones. Then I looked at Joda Money to see that the important classes are marked as final and the support for currencies is limited to the “official” ones.</p>
<h2><a href="#license" id="license"></a>License</h2>
<p>Copyright © 2021–2026 Paweł Wilk</p>
<p>This project is dual-licensed: you may use it under the terms of either</p>
<ul>
<li>the GNU Lesser General Public License v3.0 or later (LGPL-3.0-or-later), or</li>
<li>the Apache License, Version 2.0 (Apache-2.0),</li>
</ul>
<p>at your option.</p>
<p>See the license texts in:</p>
<ul>
<li><a href="85_LGPL-3-License.html"><code>LICENSES/LGPL-3.0-or-later.txt</code></a></li>
<li><a href="80_Apache-2-License.html"><code>LICENSES/Apache-2.0.txt</code></a></li>
</ul>
<p>SPDX-License-Identifier: LGPL-3.0-or-later OR Apache-2.0</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<h2><a href="#development" id="development"></a>Development</h2>
<h3><a href="#building-docs" id="building-docs"></a>Building docs</h3>
<pre><code class="language-bash">make docs
</code></pre>
<h3><a href="#building-jar" id="building-jar"></a>Building JAR</h3>
<pre><code class="language-bash">make jar
</code></pre>
<h3><a href="#updating-pom" id="updating-pom"></a>Updating POM</h3>
<pre><code class="language-bash">make pom
</code></pre>
<h3><a href="#preparing-for-release" id="preparing-for-release"></a>Preparing for release</h3>
<pre><code class="language-bash">make release
</code></pre>
<h3><a href="#deploying-to-clojars" id="deploying-to-clojars"></a>Deploying to Clojars</h3>
<pre><code class="language-bash">make deploy
</code></pre>
<h3><a href="#interactive-development" id="interactive-development"></a>Interactive development</h3>
<pre><code class="language-bash">bin/repl
</code></pre>
<p>Starts REPL (and optionally nREPL server with port number is stored in <code>.nrepl-port</code>).</p>
</div></div></div></body></html>